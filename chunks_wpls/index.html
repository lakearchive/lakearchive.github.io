<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>downloads</title>
<style>
* {margin:0;padding:0;outline:none;border:none}
body {
	font-family: sans-serif;
	background: var(--bg);
	color: var(--fg);
	margin: 10px;
	display: grid;
	gap: 10px;
	font-size: 1rem;
	--accent: #63b3ff;
	--bg: #161616;
	--fg: #dde1e6;
}
table {
	width: 100%;
	background: color-mix(in oklab, var(--bg), white 5%);
	border-collapse: collapse;
}
.table-wrapper {
	border-radius: 7px;
	overflow: hidden;
	border: 1px solid color-mix(in oklab, var(--bg), white 15%);
	width: fit-content;
}
th, td {
	padding: 0.5rem 1rem;
	border: 1px solid color-mix(in oklab, var(--bg), white 15%);
	text-align: left;
}
th {
	background: color-mix(in oklab, var(--bg), white 15%);
}
tr:nth-child(even) {
	background: color-mix(in oklab, var(--bg), white 7.5%);
}
tr td:first-child { border-left: none; }
tr td:last-child { border-right: none; }
tr:last-child td { border-bottom: none; }
a {
	color: var(--accent);
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
.button {
	border-radius: 7px;
	background-color: var(--accent);
	color: var(--bg);
	padding: 10px;
	font-family: sans-serif;
	width: fit-content;
}
.button:hover { cursor: pointer; }
.button:active { background: color-mix(in oklab, var(--accent), black 10%); }
</style>
</head>
<body>
<button class="button" onclick="downloadZip()">download as zip</button>
<div class="table-wrapper">
	<table id="fileTable">
		<tr><th>file</th><th>size</th><th>last modified</th></tr>
	</table>
</div>
<script src="/jszip.min.js"></script>
<script>
const CHUNKS_DIR = "/chunks_wpls/";
let files;
async function loadMeta() {
	const res = await fetch(CHUNKS_DIR + "index.json");

	files = await res.json();

	const table = document.getElementById("fileTable");

	for (const [name, size, mtime] of files) {
		const tr = document.createElement("tr"),
			fileLink = `<a href="${CHUNKS_DIR + name}" download>${name}</a>`;
		tr.innerHTML = `<td>${fileLink}</td><td>${formatBytes(size)}</td><td>${new Date(mtime).toLocaleString()}</td>`;
		table.appendChild(tr);
	}
}
function formatBytes(bytes) {
	const sizes = ["B","KB","MB","GB"];
	if (bytes === 0) return "0 B";
	const i = Math.floor(Math.log(bytes) / Math.log(1000));
	return (bytes / Math.pow(1000, i)).toFixed(2) + " " + sizes[i];
}
loadMeta();

async function downloadZip() {
	const zip = new JSZip();
	let latestTs = -Infinity;
	for (const [name, , mtime] of files) {
		const res = await fetch(CHUNKS_DIR + name);
		zip.file(name, await res.arrayBuffer());
		if (mtime > latestTs) latestTs = mtime;
	}
	const blob = await zip.generateAsync({ type: "blob" }),
		a = document.createElement("a");
	a.href = URL.createObjectURL(blob);
	a.download = `lakearchive-${new Date(latestTs).toISOString().replace(/:/g, "-")}.zip`;
	a.click();
	URL.revokeObjectURL(a.href);
}
</script>
</body>
</html>
